//--------------------- Tree 사용 안하는 이슈로 사용 안하는 코드. 나중에 D3 사용 시 참고자료로 남겨둠(25-05-20 cssa 김선규)

// import React, { useEffect, useRef, useState } from "react";
// import * as d3 from "d3";
// import {
//   Box,
//   Button,
//   Table,
//   TableBody,
//   TableCell,
//   TableContainer,
//   TableHead,
//   TableRow,
//   Paper,
//   Typography,
//   Checkbox,
// } from "@mui/material";

// import useClientData from "../stores/useClientData";
// import useVulStore from "../stores/useVulStore";
// import useFileStore from "../stores/useFileStore";

// // 트리 구조 생성
// const buildTree = (rawData) => {
//   const { projName } = useClientData();
//   const root = { name: projName, children: [] };

//   rawData.forEach(({ file, cveid, funcid }) => {
//     const parts = file.split("/").filter(Boolean);
//     let currentNode = root;

//     parts.forEach((part, index) => {
//       if (!currentNode.children) currentNode.children = [];

//       let foundNode = currentNode.children.find((node) => node.name === part);
//       if (!foundNode) {
//         foundNode = { name: part, children: [] };
//         currentNode.children.push(foundNode);
//       }

//       if (index === parts.length - 1) {
//         if (!foundNode.vulnerabilities) {
//           foundNode.vulnerabilities = [];
//         }
//         const exists = foundNode.vulnerabilities.some(
//           (v) => v.cveid === cveid && v.funcid === funcid
//         );
//         if (!exists) {
//           foundNode.vulnerabilities.push({ cveid, funcid });
//         }
//       }

//       currentNode = foundNode;
//     });
//   });

//   return root;
// };

// // D3 트리 렌더링 컴포넌트
// const D3Tree = ({ treeData, addFile, removeFile, selectedFiles }) => {
//   const ref = useRef();

//   useEffect(() => {
//     const width = 600;
//     const height = 320;
//     d3.select(ref.current).selectAll("*").remove();

//     const zoom = d3.zoom().on("zoom", (event) => {
//       svg.attr("transform", event.transform);
//     });

//     const svgRoot = d3
//       .select(ref.current)
//       .attr("viewBox", `-20 50 ${width} ${height}`)
//       .attr("preserveAspectRatio", "xMidYMid meet")
//       .call(zoom);

//     const svg = svgRoot.append("g");

//     const hierarchyData = d3.hierarchy(treeData);
//     const treeLayout = d3.tree().size([400, 400]);
//     treeLayout(hierarchyData);

//     const nodes = hierarchyData.descendants();
//     const links = hierarchyData.links();

//     const getNodePath = (node) => {
//       let path = [];
//       let current = node;
//       while (current.parent) {
//         path.unshift(current.data.name);
//         current = current.parent;
//       }
//       return path.join("/");
//     };

//     const isPathSelected = (nodePath) => {
//       return selectedFiles.some((file) => file.file.startsWith(nodePath));
//     };

//     const getLeafNodes = (node) => {
//       let leafNodes = [];
//       const traverse = (n) => {
//         if (!n.children) {
//           leafNodes.push(n);
//         } else {
//           n.children.forEach(traverse);
//         }
//       };
//       traverse(node);
//       return leafNodes;
//     };

//     const isSelected = (nodePath) =>
//       selectedFiles.some((file) => file.file === nodePath);

//     svg
//       .selectAll("line")
//       .data(links)
//       .enter()
//       .append("line")
//       .attr("x1", (d) => d.source.y)
//       .attr("y1", (d) => d.source.x)
//       .attr("x2", (d) => d.target.y)
//       .attr("y2", (d) => d.target.x)
//       .attr("stroke", "#aaa")
//       .attr("stroke-width", 1.5);

//     svg
//       .selectAll("circle")
//       .data(nodes)
//       .enter()
//       .append("circle")
//       .attr("cx", (d) => d.y)
//       .attr("cy", (d) => d.x)
//       .attr("r", 10)
//       .attr("fill", (d) =>
//         isSelected(getNodePath(d)) || isPathSelected(getNodePath(d))
//           ? "green"
//           : "steelblue"
//       )
//       .attr("class", "node")
//       .style("cursor", "pointer")
//       .on("click", function (event, d) {
//         const leafNodes = getLeafNodes(d);
//         const leafPaths = leafNodes.flatMap((n) =>
//           (n.data.vulnerabilities || []).map((v) => ({
//             file: getNodePath(n),
//             cve: v.cveid,
//             funcid: v.funcid,
//           }))
//         );

//         const anyLeafSelected = leafPaths.some((leaf) =>
//           selectedFiles.some(
//             (file) =>
//               file.file === leaf.file &&
//               file.cve === leaf.cve &&
//               file.funcid === leaf.funcid
//           )
//         );

//         if (anyLeafSelected) {
//           leafPaths.forEach((leaf) => removeFile(leaf));
//         } else {
//           leafPaths.forEach((leaf) => addFile(leaf));
//         }

//         svg
//           .selectAll("circle")
//           .transition()
//           .duration(200)
//           .attr("fill", (d) =>
//             isSelected(getNodePath(d)) || isPathSelected(getNodePath(d))
//               ? "green"
//               : "steelblue"
//           );
//       });

//     svg
//       .selectAll("text.parent-label")
//       .data(nodes.filter((d) => d.children))
//       .enter()
//       .append("text")
//       .attr("class", "parent-label")
//       .attr("x", (d) => d.y)
//       .attr("y", (d) => d.x + 20)
//       .attr("text-anchor", "middle")
//       .text((d) => d.data.name)
//       .style("font-size", "12px")
//       .attr("fill", "#333");

//     svg
//       .selectAll("text.leaf-label")
//       .data(nodes.filter((d) => !d.children))
//       .enter()
//       .append("text")
//       .attr("class", "leaf-label")
//       .attr("x", (d) => d.y + 10)
//       .attr("y", (d) => d.x + 5)
//       .attr("text-anchor", "start")
//       .style("font-size", "12px")
//       .attr("fill", "#333")
//       .each(function (d) {
//         const text = d3.select(this);
//         const vulns = d.data.vulnerabilities;

//         text
//           .append("tspan")
//           .text(d.data.name)
//           .attr("x", d.y + 10)
//           .attr("dy", "0em");

//         if (vulns && vulns.length > 0) {
//           vulns.forEach((v) => {
//             text
//               .append("tspan")
//               .text(`${v.cveid} (func ${v.funcid})`)
//               .attr("x", d.y + 10)
//               .attr("dy", "1.2em");
//           });
//         }
//       });
//   }, [treeData, addFile, removeFile, selectedFiles]);

//   return (
//     <Box
//       sx={{
//         display: "flex",
//         justifyContent: "center",
//         alignItems: "center",
//         borderRadius: "12px",
//         boxShadow: "0px 4px 10px rgba(0, 0, 0, 0.2)",
//         overflow: "hidden",
//         padding: 2,
//         margin: "auto",
//         height: "400px",
//       }}
//     >
//       <svg ref={ref} width="100%" height="100%"></svg>
//     </Box>
//   );
// };

// const FileTreeWithTable = () => {
//   const {
//     selectedFiles,
//     selectedVomFiles,
//     addFile,
//     removeFile,
//     vomAddFile,
//     vomRemoveFile,
//   } = useFileStore();

//   const { response, vomResponse } = useVulStore();
//   const treeData = buildTree(response.raw_data);

//   console.log("✅ Vuddy 선택된 파일 목록:", selectedFiles);

//   const [checkedItems, setCheckedItems] = useState([]);

//   // ✅ 컴포넌트가 마운트되면 raw_data에서 cveid를 추출하여 초기화
//   useEffect(() => {
//     if (vomResponse?.raw_data) {
//       const initialFiles = vomResponse.raw_data.map((item) => ({
//         cve: item.cveid,
//       }));

//       // 중복 제거 및 초기화
//       const uniqueFiles = Array.from(
//         new Set(initialFiles.map((f) => f.cve))
//       ).map((cve) => ({
//         cve,
//       }));

//       // ✅ 스토어에 초기화
//       uniqueFiles.forEach((file) => vomAddFile(file));
//     }
//   }, [vomResponse, vomAddFile]);

//   // ✅ VOM 체크박스 핸들러
//   const handleCheckboxChange = (file) => {
//     if (checkedItems.includes(file.cve)) {
//       setCheckedItems(checkedItems.filter((item) => item !== file.cve));
//       vomRemoveFile(file);
//     } else {
//       setCheckedItems([...checkedItems, file.cve]);
//       vomAddFile(file);
//     }
//   };

//   return (
//     <>
//       <Typography
//         variant="h4"
//         sx={{ textAlign: "left", margin: "20px 0 10px 0" }}
//       >
//         Vuddy
//       </Typography>
//       <Box
//         sx={{
//           padding: "20px",
//           border: "1px solid rgb(153, 153, 153)",
//           borderRadius: "10px",
//         }}
//       >
//         {/* ------------------------------------- cve 리스트 트리 ---------------------------------------- */}
//         <Typography
//           variant="h6"
//           sx={{ textAlign: "left", margin: "0 0 20px 0" }}
//         >
//           File Structure with Vuddy Vulnarable Files
//         </Typography>

//         <D3Tree
//           treeData={treeData}
//           addFile={addFile}
//           removeFile={removeFile}
//           selectedFiles={selectedFiles}
//         />

//         {/* ------------------------------------- 선택된 cve 리스트 테이블 ---------------------------------------- */}
//         <Box sx={{ marginTop: 4 }}>
//           <Typography variant="h6" sx={{ textAlign: "left", margin: "20px 0" }}>
//             Selected Vuddy CVEs
//           </Typography>

//           <TableContainer
//             component={Paper}
//             sx={{
//               maxHeight: "300px",
//               minWidth: "600px",
//               borderRadius: "12px",
//               boxShadow: "0px 4px 10px rgba(0, 0, 0, 0.2)",
//               overflowY: "scroll", // ✅ 항상 스크롤 표시
//             }}
//           >
//             <Table stickyHeader>
//               <TableHead>
//                 <TableRow>
//                   <TableCell
//                     align="center"
//                     sx={{ fontWeight: "bold", width: "80px" }}
//                   >
//                     Rank
//                   </TableCell>
//                   <TableCell
//                     align="center"
//                     sx={{ fontWeight: "bold", width: "240px" }}
//                   >
//                     File
//                   </TableCell>
//                   <TableCell
//                     align="center"
//                     sx={{ fontWeight: "bold", width: "160px" }}
//                   >
//                     CVE
//                   </TableCell>
//                   <TableCell
//                     align="center"
//                     sx={{ fontWeight: "bold", width: "120px" }}
//                   >
//                     Function ID
//                   </TableCell>
//                   <TableCell
//                     align="center"
//                     sx={{ fontWeight: "bold", width: "80px" }}
//                   />
//                 </TableRow>
//               </TableHead>
//               <TableBody>
//                 {[
//                   ...selectedFiles,
//                   ...Array(Math.max(0, 4 - selectedFiles.length)).fill({
//                     file: "",
//                     cve: "",
//                     funcid: "",
//                   }),
//                 ].map((file, index) => (
//                   <TableRow
//                     key={`${file.file}-${file.cve}-${file.funcid}-${index}`}
//                     hover
//                     sx={{ height: "56px" }}
//                   >
//                     <TableCell align="center">
//                       {file?.file ? index + 1 : "\u00A0"}
//                     </TableCell>
//                     <TableCell align="center" sx={{ wordBreak: "break-word" }}>
//                       {file?.file || "\u00A0"}
//                     </TableCell>
//                     <TableCell align="center">
//                       {file?.cve || "\u00A0"}
//                     </TableCell>
//                     <TableCell align="center">
//                       {file?.funcid || "\u00A0"}
//                     </TableCell>
//                     <TableCell align="center">
//                       {file?.file ? (
//                         <Button
//                           variant="contained"
//                           color="error"
//                           size="small"
//                           onClick={() => removeFile(file)}
//                         >
//                           Delete
//                         </Button>
//                       ) : (
//                         "\u00A0"
//                       )}
//                     </TableCell>
//                   </TableRow>
//                 ))}
//               </TableBody>
//             </Table>
//           </TableContainer>
//         </Box>
//       </Box>
//     </>
//   );
// };

// export default FileTreeWithTable;
